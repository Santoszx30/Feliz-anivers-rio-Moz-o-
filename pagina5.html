<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>PÃ¡gina 5</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  user-select: none;
}

body {
  min-height: 100vh;
  background: linear-gradient(
    180deg,
    #2b1055 0%,
    #12001f 60%,
    #000 100%
  );
  font-family: Arial, sans-serif;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  margin: 20px;
  font-size: 20px;
  text-align: center;
}

#contador {
  margin-bottom: 10px;
  font-size: 14px;
  opacity: 0.8;
}

#frame {
  border: 4px solid #7a3cff;
  border-radius: 16px;
  padding: 10px;
}

canvas {
  display: block;
  border-radius: 10px;
  touch-action: none;
}

#final {
  display: none;
  text-align: center;
  margin: 30px 20px;
}

#final h2 {
  font-size: 22px;
  margin-bottom: 10px;
}

#final p {
  font-size: 15px;
  opacity: 0.9;
}

button {
  margin-top: 20px;
  padding: 12px 25px;
  border: none;
  border-radius: 20px;
  background: #7a3cff;
  color: white;
  font-size: 16px;
}
</style>
</head>

<body>

<h1>ðŸŽ¨ Pinte a maneira de como eu enxergo sua beleza</h1>
<div id="contador">Pixels pintados: 0%</div>

<div id="frame">
  <canvas id="canvas"></canvas>
</div>

<div id="final">
  <h2>Feliz aniversÃ¡rio minha nenÃ©m ðŸ’œ</h2>
  <p>
    vocÃª Ã© tÃ£o linda como a lua e brilha tanto como o Sol.<br>
    Eu te amo.
  </p>
  <button onclick="location.href='pagina6.html'">Continuar</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const pixelSize = 22;

const img = new Image();
img.src = "coracao/amor1.jpg";

let cols, rows;
let pixels = [];
let totalPixels = 0;
let paintedPixels = 0;

function resizeCanvas() {
  const maxWidth = window.innerWidth * 0.9;
  const maxHeight = window.innerHeight * 0.65;

  const scale = Math.min(
    maxWidth / img.width,
    maxHeight / img.height
  );

  canvas.width = Math.floor(img.width * scale);
  canvas.height = Math.floor(img.height * scale);

  cols = Math.floor(canvas.width / pixelSize);
  rows = Math.floor(canvas.height / pixelSize);

  totalPixels = cols * rows;
}

img.onload = () => {
  resizeCanvas();

  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const px = x * pixelSize;
      const py = y * pixelSize;
      const i = ((py * canvas.width) + px) * 4;

      pixels.push({
        x,
        y,
        color: `rgb(${imageData[i]},${imageData[i+1]},${imageData[i+2]})`,
        painted: false
      });

      ctx.fillStyle = "#000";
      ctx.fillRect(px, py, pixelSize, pixelSize);
    }
  }
};

function paint(e) {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches ? e.touches[0] : e;

  const x = Math.floor((touch.clientX - rect.left) / pixelSize);
  const y = Math.floor((touch.clientY - rect.top) / pixelSize);

  pixels.forEach(p => {
    if (p.x === x && p.y === y && !p.painted) {
      p.painted = true;
      paintedPixels++;

      ctx.fillStyle = p.color;
      ctx.fillRect(
        p.x * pixelSize,
        p.y * pixelSize,
        pixelSize,
        pixelSize
      );

      updateCounter();
    }
  });
}

function updateCounter() {
  const percent = Math.floor((paintedPixels / totalPixels) * 100);
  document.getElementById("contador").innerText =
    `Pixels pintados: ${percent}%`;

  if (percent >= 100) {
    document.getElementById("final").style.display = "block";
  }
}

canvas.addEventListener("touchstart", paint);
canvas.addEventListener("touchmove", paint);
canvas.addEventListener("mousedown", e => {
  paint(e);
  canvas.addEventListener("mousemove", paint);
});
window.addEventListener("mouseup", () => {
  canvas.removeEventListener("mousemove", paint);
});
</script>

</body>
</html>
