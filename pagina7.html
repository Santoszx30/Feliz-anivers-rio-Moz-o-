<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Página 7 ♟️</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #3b0a57, #12001a);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: Arial, sans-serif;
}

#board {
  width: 90vmin;
  height: 90vmin;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  border: 5px solid #a855f7;
  box-shadow: 0 0 25px #a855f7;
}

.cell {
  width: 100%;
  height: 100%;
}

.dark {
  background: #0b0b0b;
}

.light {
  background: #1a1a1a;
}

.piece {
  width: 80%;
  height: 80%;
  border-radius: 50%;
  margin: auto;
  margin-top: 10%;
}

.player {
  background: #9333ea;
}

.ai {
  background: #dc2626;
}

.king {
  border: 3px solid gold;
}

.highlight {
  outline: 3px solid #22c55e;
}
</style>
</head>

<body>

<div id="board"></div>

<script>
const board = document.getElementById("board");
let cells = [];
let selected = null;
let turn = "player";

const SIZE = 8;

// MATRIZ
let state = Array.from({ length: SIZE }, () => Array(SIZE).fill(null));

function createBoard() {
  board.innerHTML = "";
  cells = [];

  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const cell = document.createElement("div");
      cell.className = "cell " + ((x + y) % 2 ? "dark" : "light");
      cell.dataset.x = x;
      cell.dataset.y = y;

      cell.onclick = () => onCellClick(x, y);
      board.appendChild(cell);
      cells.push(cell);
    }
  }
}

function placePieces() {
  for (let y = 0; y < 3; y++) {
    for (let x = 0; x < SIZE; x++) {
      if ((x + y) % 2 === 1) state[y][x] = { type: "ai", king: false };
    }
  }

  for (let y = 5; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      if ((x + y) % 2 === 1) state[y][x] = { type: "player", king: false };
    }
  }
}

function render() {
  cells.forEach(cell => cell.innerHTML = "");

  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const piece = state[y][x];
      if (piece) {
        const el = document.createElement("div");
        el.className = `piece ${piece.type}` + (piece.king ? " king" : "");
        cells[y * SIZE + x].appendChild(el);
      }
    }
  }
}
  
function playerHasCapture() {
  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const p = state[y][x];
      if (p && p.type === "player") {
        for (let dx of [-2, 2]) {
          for (let dy of [-2]) {
            const nx = x + dx;
            const ny = y + dy;
            if (
              nx >= 0 && nx < SIZE &&
              ny >= 0 && ny < SIZE &&
              isMoveValid(x, y, nx, ny)
            ) {
              return true;
            }
          }
        }
      }
    }
  }
  return false;
  }
  
function onCellClick(x, y) {
  if (turn !== "player") return;

  clearHighlights();

  const piece = state[y][x];

  if (selected && isMoveValid(selected.x, selected.y, x, y)) {
    movePiece(selected.x, selected.y, x, y);
    selected = null;
    turn = "ai";
    setTimeout(aiMove, 600);
    return;
  }

  if (piece && piece.type === "player") {
    selected = { x, y };
    highlightMoves(x, y);
  }
}


function isMoveValid(x1, y1, x2, y2) {
  if (state[y2][x2]) return false;

  const piece = state[y1][x1];
  const dx = x2 - x1;
  const dy = y2 - y1;

  if (!piece.king && dy !== -1 && dy !== -2) return false;
  if (Math.abs(dx) !== Math.abs(dy)) return false;

  const hasCapture = playerHasCapture();

  // CAPTURA
  if (Math.abs(dx) === 2) {
    const mx = (x1 + x2) / 2;
    const my = (y1 + y2) / 2;
    return state[my][mx] && state[my][mx].type === "ai";
  }

  // MOVIMENTO SIMPLES (bloqueado se existir captura)
  if (Math.abs(dx) === 1 && !hasCapture) {
    return true;
  }

  return false;
}

function movePiece(x1, y1, x2, y2) {
  const piece = state[y1][x1];
  state[y2][x2] = piece;
  state[y1][x1] = null;

  if (Math.abs(x2 - x1) === 2) {
    const mx = (x1 + x2) / 2;
    const my = (y1 + y2) / 2;
    state[my][mx] = null;
  }

  if (y2 === 0) piece.king = true;
  render();
}

function highlightMoves(x, y) {
  for (let dy of [-1, -2]) {
    for (let dx of [-2, -1, 1, 2]) {
      const nx = x + dx;
      const ny = y + dy;
      if (nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE) {
        if (isMoveValid(x, y, nx, ny)) {
          cells[ny * SIZE + nx].classList.add("highlight");
        }
      }
    }
  }
}

function clearHighlights() {
  cells.forEach(c => c.classList.remove("highlight"));
}

function aiMove() {
  let moves = [];

  for (let y = 0; y < SIZE; y++) {
    for (let x = 0; x < SIZE; x++) {
      const p = state[y][x];
      if (p && p.type === "ai") {
        for (let dx of [-1, 1]) {
          for (let dy of [1]) {
            const nx = x + dx;
            const ny = y + dy;
            if (nx >= 0 && nx < SIZE && ny < SIZE && !state[ny][nx]) {
              moves.push({ x1: x, y1: y, x2: nx, y2: ny });
            }
          }
        }
      }
    }
  }

  if (moves.length) {
    const m = moves[Math.floor(Math.random() * moves.length)];
    movePiece(m.x1, m.y1, m.x2, m.y2);
  }

  turn = "player";
}

createBoard();
placePieces();
render();
</script>

</body>
</html>
