<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P√°gina 7 ‚ôüÔ∏èüíú</title>

<style>
*{
  box-sizing:border-box;
  user-select:none;
}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  font-family:Poppins,sans-serif;
  background:radial-gradient(circle at top,#4b1170,#12001a);
  color:white;
}

h1{
  margin:20px 0 10px;
  font-size:1.5rem;
}

/* TABULEIRO */
#board{
  width:92vw;
  max-width:520px;
  aspect-ratio:1;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  border:4px solid #a855f7;
  box-shadow:0 0 35px rgba(180,0,255,0.7);
}

/* CASAS */
.cell{
  display:flex;
  align-items:center;
  justify-content:center;
}

.dark{ background:#0b0016; }
.light{ background:#1b1026; }

/* PE√áAS */
.piece{
  width:78%;
  height:78%;
  border-radius:50%;
  touch-action:none;
}

.player{
  background:radial-gradient(circle,#d08cff,#7c2aff);
}

.enemy{
  background:radial-gradient(circle,#ff7a7a,#b30000);
}

.king{
  outline:3px solid gold;
}

/* DESTAQUE */
.highlight{
  outline:3px dashed #c084fc;
}
</style>
</head>

<body>

<h1>Jogo de Damas üíú</h1>

<div id="board"></div>

<script>
const board=document.getElementById("board");
let turn="player";
let selected=null;
let moves=[];

/* UTIL */
const idxToRC=i=>({r:Math.floor(i/8),c:i%8});
const rcToIdx=(r,c)=>r>=0&&r<8&&c>=0&&c<8?r*8+c:null;

/* TABULEIRO */
for(let r=0;r<8;r++){
  for(let c=0;c<8;c++){
    const cell=document.createElement("div");
    cell.className="cell "+((r+c)%2?"dark":"light");
    board.appendChild(cell);

    if(r<3 && (r+c)%2) cell.appendChild(createPiece("enemy"));
    if(r>4 && (r+c)%2) cell.appendChild(createPiece("player"));
  }
}

/* PE√áA */
function createPiece(type){
  const p=document.createElement("div");
  p.className="piece "+type;
  if(type==="player") enable(p);
  return p;
}

/* MOVIMENTOS */
function getMoves(piece){
  const idx=[...board.children].indexOf(piece.parentElement);
  const {r,c}=idxToRC(idx);
  const dir=piece.classList.contains("player")?-1:1;
  const res=[];
  const captures=[];

  [[dir,-1],[dir,1]].forEach(([dr,dc])=>{
    const mid=rcToIdx(r+dr,c+dc);
    const land=rcToIdx(r+dr*2,c+dc*2);

    if(mid!==null && land!==null){
      const midCell=board.children[mid];
      const landCell=board.children[land];

      if(midCell.firstChild &&
         midCell.firstChild.classList.contains("enemy") &&
         !landCell.firstChild){
        captures.push({land,mid});
      }
    }
  });

  if(captures.length) return captures;

  [[dir,-1],[dir,1]].forEach(([dr,dc])=>{
    const t=rcToIdx(r+dr,c+dc);
    if(t!==null && !board.children[t].firstChild)
      res.push({land:t});
  });

  return res;
}

/* SELE√á√ÉO */
function enable(piece){
  piece.addEventListener("pointerdown",()=>{
    if(turn!=="player") return;
    clear();
    selected=piece;
    moves=getMoves(piece);
    moves.forEach(m=>board.children[m.land].classList.add("highlight"));
  });
}

/* CLICK */
board.addEventListener("click",e=>{
  if(!selected) return;
  const cell=e.target.closest(".cell");
  if(!cell) return;
  const idx=[...board.children].indexOf(cell);

  const move=moves.find(m=>m.land===idx);
  if(move){
    cell.appendChild(selected);

    if(move.mid!==undefined){
      board.children[move.mid].innerHTML="";
    }

    promote(selected);
    clear();
    selected=null;
    turn="enemy";
    setTimeout(enemyMove,600);
  }
});

/* PROMO√á√ÉO */
function promote(piece){
  const idx=[...board.children].indexOf(piece.parentElement);
  const {r}=idxToRC(idx);
  if(piece.classList.contains("player") && r===0 && !piece.classList.contains("king")){
    piece.classList.add("king");
    alert("No cora√ß√£o de um homem sempre h√° uma menina, assim como num tabuleiro, um rei sempre precisa de sua rainha üíú");
  }
}

/* IA SIMPLES */
function enemyMove(){
  const enemies=[...document.querySelectorAll(".enemy")];
  for(const p of enemies){
    const idx=[...board.children].indexOf(p.parentElement);
    const {r,c}=idxToRC(idx);

    for(const dc of [-1,1]){
      const mid=rcToIdx(r+1,c+dc);
      const land=rcToIdx(r+2,c+dc*2);
      if(mid!==null && land!==null){
        const midCell=board.children[mid];
        const landCell=board.children[land];
        if(midCell.firstChild?.classList.contains("player") && !landCell.firstChild){
          landCell.appendChild(p);
          midCell.innerHTML="";
          turn="player";
          return;
        }
      }
    }
  }

  for(const p of enemies){
    const idx=[...board.children].indexOf(p.parentElement);
    const {r,c}=idxToRC(idx);
    for(const dc of [-1,1]){
      const t=rcToIdx(r+1,c+dc);
      if(t!==null && !board.children[t].firstChild){
        board.children[t].appendChild(p);
        turn="player";
        return;
      }
    }
  }

  turn="player";
}

/* LIMPAR */
function clear(){
  document.querySelectorAll(".highlight").forEach(h=>h.classList.remove("highlight"));
}
</script>

</body>
</html>
